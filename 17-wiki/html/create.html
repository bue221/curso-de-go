<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crear Nueva Página - Wiki</title>
    <link rel="stylesheet" href="/styles/common.css" />
    <style>
      .create-form {
        background: var(--gradient-card);
        padding: 30px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        margin-bottom: 30px;
      }

      .form-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .form-title {
        font-size: 1.8rem;
        color: var(--primary-green);
        margin-bottom: 10px;
      }

      .form-subtitle {
        color: var(--text-muted);
        font-size: 1rem;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
      }

      .form-row.full {
        grid-template-columns: 1fr;
      }

      .form-textarea {
        min-height: 300px;
        font-family: "Courier New", monospace;
        line-height: 1.6;
      }

      .help-section {
        background: var(--accent-black);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border-left: 4px solid var(--primary-green);
      }

      .help-title {
        color: var(--primary-green);
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .help-content {
        color: var(--text-light);
        line-height: 1.6;
      }

      .help-content code {
        background: var(--secondary-black);
        padding: 2px 6px;
        border-radius: 4px;
        color: var(--primary-green);
        font-family: "Courier New", monospace;
      }

      .help-content ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .help-content li {
        margin-bottom: 5px;
      }

      .preview-section {
        background: var(--accent-black);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid var(--border-color);
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .preview-title {
        color: var(--primary-green);
        font-weight: 600;
      }

      .preview-toggle {
        background: var(--secondary-black);
        border: 1px solid var(--border-color);
        color: var(--text-light);
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
      }

      .preview-content {
        color: var(--text-light);
        line-height: 1.6;
        max-height: 200px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-family: "Segoe UI", sans-serif;
      }

      .preview-content.hidden {
        display: none;
      }

      .form-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn-large {
        padding: 15px 30px;
        font-size: 1.1rem;
        min-width: 150px;
      }

      .templates-section {
        background: var(--gradient-card);
        padding: 25px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        margin-bottom: 30px;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .template-card {
        background: var(--accent-black);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .template-card:hover {
        border-color: var(--primary-green);
        transform: translateY(-2px);
      }

      .template-title {
        color: var(--primary-green);
        font-weight: 600;
        margin-bottom: 10px;
      }

      .template-description {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      .template-preview {
        color: var(--text-light);
        font-size: 0.8rem;
        font-family: "Courier New", monospace;
        background: var(--secondary-black);
        padding: 10px;
        border-radius: 4px;
        max-height: 100px;
        overflow: hidden;
      }

      .validation-message {
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        font-size: 0.9rem;
        display: none;
      }

      .validation-error {
        background: rgba(255, 68, 68, 0.1);
        border: 1px solid #ff4444;
        color: #ff6666;
      }

      .validation-success {
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid var(--primary-green);
        color: var(--primary-green);
      }
    </style>
  </head>
  <body>
    <div class="container fade-in">
      <div class="header">
        <div class="wiki-logo">📚 <span>Wiki</span></div>
        <h1 class="main-title">Crear Nueva Página</h1>
        <p class="subtitle">Añade contenido a tu wiki con una nueva página</p>
      </div>

      <div class="content">
        <!-- Plantillas disponibles -->
        <div class="templates-section">
          <h2 style="color: var(--primary-green); margin-bottom: 15px">
            📋 Plantillas Disponibles
          </h2>
          <p style="color: var(--text-muted); margin-bottom: 20px">
            Selecciona una plantilla para comenzar rápidamente, o crea una
            página desde cero.
          </p>

          <div class="templates-grid">
            <div class="template-card" onclick="loadTemplate('basic')">
              <div class="template-title">📄 Página Básica</div>
              <div class="template-description">
                Una página simple con título y contenido
              </div>
              <div class="template-preview">
                # Mi Página Contenido de la página aquí...
              </div>
            </div>

            <div class="template-card" onclick="loadTemplate('article')">
              <div class="template-title">📰 Artículo</div>
              <div class="template-description">
                Formato para artículos con introducción y secciones
              </div>
              <div class="template-preview">
                # Título del Artículo ## Introducción Breve introducción... ##
                Desarrollo Contenido principal...
              </div>
            </div>

            <div class="template-card" onclick="loadTemplate('tutorial')">
              <div class="template-title">🎓 Tutorial</div>
              <div class="template-description">
                Guía paso a paso con instrucciones
              </div>
              <div class="template-preview">
                # Tutorial: Cómo hacer... ## Requisitos - Item 1 - Item 2 ##
                Pasos 1. Primer paso 2. Segundo paso...
              </div>
            </div>

            <div class="template-card" onclick="loadTemplate('notes')">
              <div class="template-title">📝 Notas</div>
              <div class="template-description">Para tomar notas y apuntes</div>
              <div class="template-preview">
                # Notas - [Tema] ## Puntos importantes - Punto 1 - Punto 2 ##
                Referencias - Enlace 1 - Enlace 2
              </div>
            </div>
          </div>
        </div>

        <!-- Formulario de creación -->
        <div class="create-form">
          <div class="form-header">
            <h2 class="form-title">✏️ Crear Nueva Página</h2>
            <p class="form-subtitle">
              Completa los campos para crear tu nueva página
            </p>
          </div>

          <div id="validationMessage" class="validation-message"></div>

          <form method="POST" action="/save" id="createForm">
            <div class="form-row">
              <div class="form-group">
                <label for="title" class="form-label"
                  >Título de la Página *</label
                >
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="form-input"
                  placeholder="Ej: Mi Primera Página"
                  required
                />
              </div>
              <div class="form-group">
                <label for="category" class="form-label"
                  >Categoría (opcional)</label
                >
                <input
                  type="text"
                  id="category"
                  name="category"
                  class="form-input"
                  placeholder="Ej: Tutorial, Notas, Referencia"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="body" class="form-label"
                >Contenido de la Página *</label
              >
              <textarea
                id="body"
                name="body"
                class="form-textarea"
                placeholder="Escribe el contenido de tu página aquí. Puedes usar Markdown para formatear el texto..."
                required
              ></textarea>
            </div>

            <!-- Ayuda de Markdown -->
            <div class="help-section">
              <div class="help-title">💡 Ayuda de Markdown</div>
              <div class="help-content">
                <p>
                  Puedes usar las siguientes sintaxis para formatear tu texto:
                </p>
                <ul>
                  <li><code>**texto**</code> para <strong>negrita</strong></li>
                  <li><code>*texto*</code> para <em>cursiva</em></li>
                  <li><code># Título</code> para títulos grandes</li>
                  <li><code>## Subtítulo</code> para subtítulos</li>
                  <li><code>- item</code> para listas</li>
                  <li><code>[enlace](url)</code> para enlaces</li>
                  <li><code>`código`</code> para código inline</li>
                </ul>
              </div>
            </div>

            <!-- Vista previa -->
            <div class="preview-section">
              <div class="preview-header">
                <span class="preview-title">👁️ Vista Previa</span>
                <button
                  type="button"
                  class="preview-toggle"
                  onclick="togglePreview()"
                >
                  Mostrar/Ocultar
                </button>
              </div>
              <div id="previewContent" class="preview-content hidden"></div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary btn-large">
                💾 Crear Página
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-large"
                onclick="clearForm()"
              >
                🗑️ Limpiar
              </button>
              <a href="/list" class="btn btn-secondary btn-large">
                📋 Ver Lista
              </a>
            </div>
          </form>
        </div>
      </div>

      <div class="footer">
        <div class="footer-info">
          <span>📚 Wiki • Crear nueva página</span>
        </div>
        <div class="footer-actions">
          <a href="/list" class="btn btn-secondary btn-small"> 📋 Lista </a>
          <a href="/" class="btn btn-secondary btn-small"> 🏠 Inicio </a>
        </div>
      </div>
    </div>

    <script>
      // Plantillas predefinidas
      const templates = {
        basic: `# Mi Página

Contenido de la página aquí...

## Sección 1
Texto de la sección.

## Sección 2
Más contenido.`,

        article: `# Título del Artículo

## Introducción
Breve introducción al tema que vas a tratar.

## Desarrollo
Contenido principal del artículo con explicaciones detalladas.

### Subsección
Información adicional organizada en subsecciones.

## Conclusión
Resumen de los puntos principales tratados.`,

        tutorial: `# Tutorial: Cómo hacer...

## Requisitos
- Requisito 1
- Requisito 2
- Requisito 3

## Pasos

### Paso 1: Preparación
Descripción del primer paso.

### Paso 2: Implementación
Descripción del segundo paso.

### Paso 3: Verificación
Cómo verificar que todo funciona correctamente.

## Consejos
- Consejo útil 1
- Consejo útil 2`,

        notes: `# Notas - [Tema]

## Puntos importantes
- Punto clave 1
- Punto clave 2
- Punto clave 3

## Referencias
- [Enlace útil 1](url)
- [Enlace útil 2](url)

## Ideas
- Idea para desarrollar
- Otra idea importante`,
      };

      // Cargar plantilla
      function loadTemplate(templateName) {
        const bodyTextarea = document.getElementById("body");
        bodyTextarea.value = templates[templateName];
        updatePreview();
        showValidation("Plantilla cargada correctamente", "success");
      }

      // Actualizar vista previa
      function updatePreview() {
        const body = document.getElementById("body").value;
        const preview = document.getElementById("previewContent");

        // Conversión básica de Markdown a HTML
        let html = body
          .replace(/^# (.*$)/gim, "<h1>$1</h1>")
          .replace(/^## (.*$)/gim, "<h2>$1</h2>")
          .replace(/^### (.*$)/gim, "<h3>$1</h3>")
          .replace(/\*\*(.*?)\*\*/gim, "<strong>$1</strong>")
          .replace(/\*(.*?)\*/gim, "<em>$1</em>")
          .replace(/^- (.*$)/gim, "<li>$1</li>")
          .replace(/^(\d+)\. (.*$)/gim, "<li>$2</li>")
          .replace(/`(.*?)`/gim, "<code>$1</code>")
          .replace(/\n/gim, "<br>");

        preview.innerHTML = html;
      }

      // Alternar vista previa
      function togglePreview() {
        const preview = document.getElementById("previewContent");
        preview.classList.toggle("hidden");
        updatePreview();
      }

      // Limpiar formulario
      function clearForm() {
        if (confirm("¿Estás seguro de que quieres limpiar el formulario?")) {
          document.getElementById("createForm").reset();
          document.getElementById("previewContent").innerHTML = "";
          hideValidation();
        }
      }

      // Mostrar mensaje de validación
      function showValidation(message, type) {
        const validationDiv = document.getElementById("validationMessage");
        validationDiv.textContent = message;
        validationDiv.className = `validation-message validation-${type}`;
        validationDiv.style.display = "block";

        setTimeout(() => {
          hideValidation();
        }, 5000);
      }

      // Ocultar mensaje de validación
      function hideValidation() {
        document.getElementById("validationMessage").style.display = "none";
      }

      // Validar formulario
      function validateForm() {
        const title = document.getElementById("title").value.trim();
        const body = document.getElementById("body").value.trim();

        if (!title) {
          showValidation("El título es obligatorio", "error");
          return false;
        }

        if (!body) {
          showValidation("El contenido es obligatorio", "error");
          return false;
        }

        if (title.length < 3) {
          showValidation("El título debe tener al menos 3 caracteres", "error");
          return false;
        }

        return true;
      }

      // Event listeners
      document.getElementById("body").addEventListener("input", updatePreview);

      document
        .getElementById("createForm")
        .addEventListener("submit", function (e) {
          if (!validateForm()) {
            e.preventDefault();
          }
        });

      // Auto-guardado local (opcional)
      setInterval(() => {
        const title = document.getElementById("title").value;
        const body = document.getElementById("body").value;

        if (title || body) {
          localStorage.setItem("wiki_draft_title", title);
          localStorage.setItem("wiki_draft_body", body);
        }
      }, 30000);

      // Cargar borrador guardado
      window.addEventListener("load", () => {
        const savedTitle = localStorage.getItem("wiki_draft_title");
        const savedBody = localStorage.getItem("wiki_draft_body");

        if (savedTitle || savedBody) {
          if (confirm("Se encontró un borrador guardado. ¿Quieres cargarlo?")) {
            if (savedTitle) document.getElementById("title").value = savedTitle;
            if (savedBody) document.getElementById("body").value = savedBody;
            updatePreview();
          }
        }
      });
    </script>
  </body>
</html>
